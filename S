package com.epay.transaction.validator;

import com.epay.transaction.model.request.TransactionUpdateRequest;
import com.sbi.epay.logging.utility.LoggerFactoryUtility;
import com.sbi.epay.logging.utility.LoggerUtility;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Component;

import java.util.ArrayList;

import static com.epay.transaction.util.TransactionConstant.*;
import static com.epay.transaction.util.TransactionErrorConstants.ATRN;
import static com.epay.transaction.util.TransactionErrorConstants.REASON;

/**
 * Class Name: PaymentValidator
 * *
 * Description: Validates Payment Validator details .
 * *
 * Author: Shubhangi kurelay
 * Copyright (c) 2024 [State Bank of India]
 * All rights reserved
 * *
 * Version:1.0
 */

@Component
@RequiredArgsConstructor
public class PaymentValidator extends BaseValidator {
    private final LoggerUtility logger = LoggerFactoryUtility.getLogger(this.getClass());

    public void validateOrderRequest(TransactionUpdateRequest transactionUpdateRequest) {
        errorDtoList = new ArrayList<>();
        validateMandatoryFields(transactionUpdateRequest);
        validateLeadingTrailingSpacesAndSingleSpace(transactionUpdateRequest);
        validateFieldsValue(transactionUpdateRequest);
        validateSpacialCharacter(transactionUpdateRequest);
        throwIfErrors();

    }

    protected void validateSpacialCharacter(TransactionUpdateRequest transactionUpdateRequest) {
        validateFieldWithRegex(transactionUpdateRequest.getAtrn(), ATRN_ARRN_REGEX, ATRN, "Invalid Atrn format");
        validateFieldWithRegex(transactionUpdateRequest.getFailReason(), SPECIAL_CHARACTER_REGEX, REASON, "Invalid failreason format");
        throwIfErrors();

    }


    private void validateMandatoryFields(TransactionUpdateRequest transactionUpdateRequest) {
        checkMandatoryField(transactionUpdateRequest.getAtrn(), ATRN);
        checkMandatoryField(transactionUpdateRequest.getFailReason(), REASON);
        throwIfErrors();
    }

    private void validateLeadingTrailingSpacesAndSingleSpace(TransactionUpdateRequest transactionUpdateRequest) {
        checkForLeadingTrailingAndSingleSpace(transactionUpdateRequest.getAtrn(), ATRN);
        checkForLeadingTrailingAndSingleSpace(transactionUpdateRequest.getFailReason(), REASON);
        throwIfErrors();
    }

    private void validateFieldsValue(TransactionUpdateRequest transactionUpdateRequest) {
        validateFieldLength(transactionUpdateRequest.getAtrn(), ATRN_ARRN_LENGTH, ATRN);
        validateFieldLengths(transactionUpdateRequest.getFailReason(), REASON_LENGTH, REASON);
        throwIfErrors();
    }

}

